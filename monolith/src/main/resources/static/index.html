<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Micro Monolith UI</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;max-width:900px;margin:40px auto;padding:0 16px}
    form{display:grid;gap:8px;grid-template-columns:1fr 1fr}
    textarea{grid-column:1/-1;min-height:80px}
    .row{display:flex;gap:8px;align-items:center}
    button{padding:.6rem 1rem}
    pre{background:#f5f5f5;border:1px solid #ddd;border-radius:8px;padding:12px;overflow:auto}
  </style>
</head>
<body>
  <h1>Monolito · Crear Post</h1>

  <form id="postForm">
    <label>userId <input id="userId" type="number" value="1" min="1"/></label>
    <label>streamId <input id="streamId" type="number" value="1" min="1"/></label>
    <label style="grid-column:1/-1">content (≤140)
      <textarea id="content" maxlength="140" placeholder="Escribe algo..."></textarea>
    </label>
    <div class="row" style="grid-column:1/-1">
      <button type="submit">Publicar</button>
      <button type="button" id="btnList">Listar posts</button>
      <span id="status" style="margin-left:12px;color:#666"></span>
    </div>
  </form>

  <h2>Respuesta</h2>
  <pre id="out">—</pre>

<script>
const $ = sel => document.querySelector(sel);
const out = #out, status = #status;

async function createPost(e){
  e.preventDefault();
  const payload = {
    userId: Number(#userId.value),
    streamId: Number(#streamId.value),
    content: #content.value.trim()
  };
  status.textContent = "Enviando...";
  try{
    const res = await fetch("/posts", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    const txt = await res.text();
    out.textContent = res.status + " " + res.statusText + "\n" + txt;
  }catch(err){
    out.textContent = "Error: " + err;
  }finally{
    status.textContent = "";
  }
}

async function listPosts(){
  status.textContent = "Cargando...";
  try{
    const res = await fetch("/posts");
    const txt = await res.text(); // si no es JSON igual lo mostramos
    out.textContent = res.status + " " + res.statusText + "\n" + txt;
  }catch(err){
    out.textContent = "Error: " + err;
  }finally{
    status.textContent = "";
  }
}

#postForm.addEventListener("submit", createPost);
#btnList.addEventListener("click", listPosts);
</script>
</body>
</html>